<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GT World Challenge Round 7&8 2025 - Stuart Clarkson Photography</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

  <style>
    body { font-family: 'Poppins', sans-serif; }
    .card { cursor: pointer; }

    /* Modal base */
    #image-modal {
      opacity: 0;
      transition: opacity 0.45s ease-in-out;
      pointer-events: none; /* disabled until opened */
      z-index: 9999;
    }

    /* Modal visible */
    #image-modal:not(.hidden) {
      opacity: 1;
      pointer-events: auto; /* FIX: enables clicking X button */
    }

    #close-modal {
      font-size: 2rem;
      cursor: pointer;
      transition: 0.2s;
    }

    #close-modal:hover {
      color: #60a5fa;
      transform: scale(1.15);
    }

    /* Smooth up animation */
    #modal-inner {
      transform: translateY(10px);
      transition: transform 0.25s ease;
    }
    #image-modal:not(.hidden) #modal-inner {
      transform: translateY(0);
    }
  </style>
</head>

<body class="bg-gradient-to-r from-gray-900 via-black-900 to-blue-900 text-white">

<!-- Header -->
<header class="flex justify-between items-center p-5">
  <a href="https://stuartclarksonphotography.com" class="text-3xl font-bold">Stuart Clarkson</a>
  <nav>
    <ul class="flex space-x-6 text-lg">
      <li><a href="/portfolio" class="hover:text-blue-600">Portfolio</a></li>
      <li><a href="/socials" class="hover:text-blue-600">Socials</a></li>
    </ul>
  </nav>
</header>

<!-- Title -->
<center><p class="text-2xl font-bold">2025 GT World Challenge Round 7&8</p></center>
<center><p class="py-5">
  <strong>Gear Used</strong><br>
  Camera: Canon EOS R50 <br>
  Lens: Canon EF 70-300 f4-5.6 & Canon EF 24-70 f4
</p></center>

<!-- Gallery -->
<main class="flex justify-center items-center min-h-screen">
  <div id="gtwc2025-gallery"
       class="grid grid-cols-1 md:grid-cols-3 gap-3 p-10 max-w-[1500px]">
  </div>
</main>

<!-- Modal -->
<div id="image-modal"
     class="fixed inset-0 bg-black/60 backdrop-blur-md hidden flex items-center justify-center">
  <div id="modal-inner" class="relative max-w-5xl w-full p-4">
    <span id="close-modal" class="absolute top-4 right-6 text-white">Ã—</span>
    <img id="modal-img" src=""
         class="rounded-xl w-full h-auto max-h-[90vh] object-contain shadow-xl" />
  </div>
</div>

<script>
/* Supabase connection */
const SUPABASE_URL = "https://ygnfuztbwsngjihrinlr.supabase.co";
const SUPABASE_ANON_KEY =
"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlnbmZ1enRid3NuZ2ppaHJpbmxyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI5ODUwOTMsImV4cCI6MjA3ODU2MTA5M30.YlKPGDE3hfF9mOIVbUEQQFtN8gwt6L0MOYldH1AOMGw";

const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

/* Fetch images */
async function fetchGalleryImages(gallery) {
  const { data, error } = await supabase
    .from("images")
    .select("*")
    .eq("gallery", gallery)
    .order("sort_order", { ascending: true });

  if (error) {
    console.error("Error loading gallery:", error);
    return [];
  }

  return data;
}

/* Render gallery */
async function renderGallery() {
  const container = document.getElementById("gtwc2025-gallery");
  const images = await fetchGalleryImages("gtwc2025");

  container.innerHTML = images.map(img => `
    <div class="card bg-gray-800 rounded-xl overflow-hidden shadow-lg transform hover:scale-105 transition-all duration-300"
         data-src="${img.image_url}">
      <div style="aspect-ratio: 3/2;" class="w-full">
        <img src="${img.image_url}" class="w-full h-full object-cover">
      </div>
    </div>
  `).join("");

  initZoomModal();
}

/* Zoom modal logic */
function initZoomModal() {
  const modal = document.getElementById("image-modal");
  const modalImg = document.getElementById("modal-img");
  const closeBtn = document.getElementById("close-modal");

  let activeImg = null;

  document.querySelectorAll(".card img").forEach(img => {
    img.addEventListener("click", () => {
      activeImg = img;

      const rect = img.getBoundingClientRect();
      const clone = img.cloneNode();
      clone.classList.add("zoom-clone");

      Object.assign(clone.style, {
        position: "fixed",
        top: rect.top + "px",
        left: rect.left + "px",
        width: rect.width + "px",
        height: rect.height + "px",
        borderRadius: "12px",
        objectFit: "cover",
        zIndex: "99999",
        transition: "all .45s cubic-bezier(0.23,1,0.32,1)"
      });

      document.body.appendChild(clone);

      // Animate into center
      setTimeout(() => {
        const targetW = Math.min(window.innerWidth * 1, 1100);
        const targetH = targetW * 0.6667; // Assuming 3:2 aspect ratio
        const targetL = (window.innerWidth - targetW) / 2;
        const targetT = (window.innerHeight - targetH) / 2;

        Object.assign(clone.style, {
          top: targetT + "px",
          left: targetL + "px",
          width: targetW + "px",
          height: targetH + "px"
        });

        modal.classList.remove("hidden");

        setTimeout(() => {
          modalImg.src = img.src;
          clone.remove();
          document.body.style.overflow = "hidden";
        }, 450);
      }, 10);
    });
  });

  /* Close modal */
  function closeModal() {
    modal.classList.add("hidden");
    modalImg.src = "";
    document.body.style.overflow = "";

    document.querySelectorAll(".zoom-clone").forEach(c => c.remove());
    activeImg = null;
  }

  closeBtn.addEventListener("click", closeModal);
  modal.addEventListener("click", e => { if (e.target === modal) closeModal(); });
  window.addEventListener("keydown", e => { if (e.key === "Escape") closeModal(); });
}

/* Start */
document.addEventListener("DOMContentLoaded", renderGallery);
</script>

</body>
</html>
