<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Upload - Stuart Clarkson Photography</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

  <style>
    body { font-family: 'Poppins', sans-serif; }
    .hidden { display: none; }
  </style>
</head>

<body class="bg-gray-900 text-white min-h-screen flex flex-col items-center p-8">

  <!-- LOGIN -->
  <div id="loginSection" class="text-center">
    <h1 class="text-3xl font-bold mb-4">Admin Login</h1>
    <input type="password" id="passwordInput" class="px-4 py-2 rounded-lg text-black"
           placeholder="Enter Admin Password">
    <button id="loginButton"
            class="ml-2 bg-blue-600 px-4 py-2 rounded-lg hover:bg-blue-700 transition">
      Login
    </button>
    <p id="loginError" class="text-red-400 mt-3 hidden">Incorrect password</p>
  </div>

  <!-- UPLOAD SECTION -->
  <div id="uploadSection" class="hidden w-full max-w-xl bg-gray-800 p-6 rounded-xl shadow-xl mt-8">
    <h1 class="text-3xl font-bold mb-6">Upload New Image</h1>

    <form id="uploadForm" class="space-y-4">

      <div>
        <label class="block mb-1">Gallery Name:</label>
        <input type="text" id="galleryInput" class="w-full px-4 py-2 rounded-lg text-black" required>
      </div>

      <div>
        <label class="block mb-1">Image Title:</label>
        <input type="text" id="titleInput" class="w-full px-4 py-2 rounded-lg text-black">
      </div>

      <div>
        <label class="block mb-1">Select Image:</label>
        <input type="file" id="fileInput" accept="image/*" class="text-white" required>
      </div>

      <button type="submit"
              class="bg-purple-600 hover:bg-purple-700 transition px-6 py-2 rounded-lg text-lg font-semibold">
        Upload Image
      </button>
    </form>

    <div id="previewSection" class="hidden mt-6 text-center">
      <p class="text-lg font-semibold">Upload Successful!</p>
      <img id="previewImage" class="mt-3 rounded-xl max-h-96 mx-auto shadow-lg">
      <p id="imageUrl" class="mt-2 text-purple-400 break-all"></p>
    </div>
  </div>

  <!-- DELETE PANEL -->
  <div id="deletePanel" class="hidden w-full max-w-4xl bg-gray-800 p-6 rounded-xl shadow-xl mt-10">
    <h1 class="text-3xl font-bold mb-6 text-center">Manage & Delete Images</h1>

    <table class="w-full text-left">
      <thead>
        <tr class="border-b border-gray-600">
          <th class="p-2">ID</th>
          <th class="p-2">Gallery</th>
          <th class="p-2">Title</th>
          <th class="p-2">Preview</th>
          <th class="p-2">Delete</th>
        </tr>
      </thead>
      <tbody id="deleteTable"></tbody>
    </table>
  </div>

<script>
const ADMIN_PASSWORD = "123";
const SUPABASE_FUNCTION_UPLOAD = "https://ygnfuztbwsngjihrinlr.functions.supabase.co/upload";
const SUPABASE_FUNCTION_DELETE = "https://ygnfuztbwsngjihrinlr.functions.supabase.co/delete";
const SUPABASE_URL = "https://ygnfuztbwsngjihrinlr.supabase.co";
const SUPABASE_ANON_KEY = "YOUR_ANON_KEY_HERE";


// Login logic
document.getElementById("loginButton").addEventListener("click", () => {
  const pass = document.getElementById("passwordInput").value.trim();
  if (pass === ADMIN_PASSWORD) {
    document.getElementById("loginSection").classList.add("hidden");
    document.getElementById("uploadSection").classList.remove("hidden");
    document.getElementById("deletePanel").classList.remove("hidden");
    loadDeleteTable();
  } else {
    document.getElementById("loginError").classList.remove("hidden");
  }
});


// Load delete list
async function loadDeleteTable() {
  const res = await fetch(`${SUPABASE_URL}/rest/v1/images?select=*`, {
    headers: {
      apikey: SUPABASE_ANON_KEY,
      Authorization: `Bearer ${SUPABASE_ANON_KEY}`
    }
  });
  const images = await res.json();

  const table = document.getElementById("deleteTable");
  table.innerHTML = "";

  images.forEach(img => {
    const row = document.createElement("tr");
    const path = img.image_url.split("/images/")[1]; // Extract path

    row.innerHTML = `
      <td class="p-2">${img.id}</td>
      <td class="p-2">${img.gallery}</td>
      <td class="p-2">${img.title}</td>
      <td class="p-2"><img src="${img.image_url}" class="h-20 rounded"></td>
      <td class="p-2">
        <button onclick="deleteImage(${img.id}, '${path}')"
          class="bg-red-600 hover:bg-red-700 px-3 py-1 rounded">
          Delete
        </button>
      </td>
    `;

    table.appendChild(row);
  });
}


// Delete logic
async function deleteImage(id, storagePath) {
  if (!confirm("Delete this image?")) return;

  const res = await fetch(SUPABASE_FUNCTION_DELETE, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ id, storagePath })
  });

  const data = await res.json();
  if (data.success) {
    alert("Image deleted.");
    loadDeleteTable();
  } else {
    alert("Error deleting image.");
  }
}
</script>

</body>
</html>
